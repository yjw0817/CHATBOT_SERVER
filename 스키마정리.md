요청: 현재 DB(SQLite)에 이미 쌓여 있는 기존 문서/섹션 데이터까지 포함해,
RAG 매뉴얼 파이프라인(Manualize→flatten→Gate→Fill→Gate→Publish)을 "이관 가능한 스키마"로 정리해줘.

[현재 상태]
- manual_sections.section_text(plain text)만 DB에 저장됨.
- Manualize JSON은 저장되지 않고 flatten 과정에서 소실됨.
- Fill은 section_text를 덮어씀(히스토리 없음).
- Gate 결과 저장도 없음.

[목표]
1) 앞으로 생성되는 데이터는 "이관 가능한 형태"로 저장
2) 기존에 저장된 데이터도 한 번 정리(backfill)해서 최소한의 추적/버전/검증 정보 갖추기
3) 지금은 SQLite로 구현, 나중에 MariaDB로 옮기기 쉽게 설계

[필수 구현(앞으로의 데이터)]
A) manual_docs에 manualize_json(TEXT), raw_text_hash(TEXT) 추가
- Manualize LLM 응답(JSON 원문)을 flatten 전에 저장 (소실 방지)
B) manual_sections에 gate_status, gate_score, gate_reasons_json 추가
- Gate 결과를 저장하고 Publish 조건으로 사용
C) manual_section_revisions 테이블 추가(append-only)
- section_text가 갱신되기 전에 항상 직전 버전을 insert
- change_reason: MANUALIZE|FILL|USER_EDIT|FINALIZE
- created_at/created_by/run_id(optional) 포함

[기존 데이터 정리(backfill) — 매우 중요]
1) 기존 manual_sections 레코드에 대해:
- 최초 버전(Version 1)로 manual_section_revisions에 insert
  - version=1
  - section_text=현재 manual_sections.section_text
  - change_reason="BACKFILL"
  - created_at=현재 시각 또는 manual_sections.updated_at가 있으면 그것
2) 기존 섹션들에 대해 Gate를 1회 돌려 상태를 채움
- section_text + (가능하면 원문 raw_text)로 Gate 체크 실행
- raw_text가 DB에 없으면, Gate에서 HALLUCINATION_RISK는 완화하고 FORMAT/PII 중심으로라도 판정
- 결과를 manual_sections.gate_status/score/reasons_json에 업데이트
3) 기존 데이터는 Manualize JSON이 없으므로,
- (선택) "RECONSTRUCT_MANUALIZE_JSON" 작업을 제공:
  - section_text(plain text)들을 역으로 rule 구조(JSON)로 재구성하는 LLM 작업(원문이 없으니 '근거 인용'은 불가)
  - 재구성 JSON은 manual_docs.manualize_json_reconstructed 같은 별도 컬럼/테이블에 저장
  - 단, 이건 '추정'이므로 doc_type="MIXED", issues에 "SOURCE_MISSING"를 강제 표시

[스키마/DDL(SQLite)]
- 위 컬럼 추가 ALTER + revisions 테이블 CREATE SQL을 정확히 제시해줘.
- 이관 목표(MariaDB) 정규화 스키마 초안도 함께 제시해줘:
  documents, sections, section_revisions, document_runs(LLM trace), (옵션) rules/evidence

[마이그레이션 스크립트/절차]
- backfill 작업을 실행하는 스크립트(예: python 또는 node) 작성:
  - 모든 doc_id 순회
  - 섹션별 revision insert(중복 방지)
  - Gate 실행 후 sections 업데이트
  - 실행 로그/재실행 idempotent 처리(이미 backfill된 건 스킵)

[Publish 정책]
- Publish/RAG 반영은 Gate#2가 PASS인 섹션만 허용
- NEED_FIX/BLOCK 섹션은 반영 금지, UI에 배지 표시

[프롬프트]
- MANUALIZE_PROMPT_V3 / GATE_CHECK_PROMPT_V1 / FILL_SECTION_TEXT_PROMPT_V2 를 그대로 사용
(내가 아래에 붙인다)

산출물:
1) SQLite DDL(ALTER/CREATE) + 적용 순서
2) backfill 스크립트(재실행 안전)
3) API/서비스 레이어 변경점(업데이트 시 revision insert 포함)
4) MariaDB 목표 스키마(정규화 버전) 초안
