[작업 지시] Manualize·Gate·RAG 데이터화 통합 개선
배경

현행 시스템에서는 문서 업로드 후 Extract → Manualize → Upgrade → Edit → Gate → Approve 순으로 여러 단계를 거칩니다. 이번 개선에서는 다음과 같은 통합·수정이 필요합니다.

요구 변경 사항

Upgrade & Edit 제거

Upgrade 버튼과 Edit 버튼을 완전히 제거합니다.

대신 Manualize 단계에서 AI가 문서를 가다듬고, 부족한 부분이나 모호한 부분에 대해 추가 정보 또는 수정 요청을 사용자에게 자동으로 제안하도록 합니다.

Manualize 개선

Extract된 원문을 사용하여 AI가 6개 섹션 매뉴얼(운영시간/예약/강좌/환불/공지/예외)을 생성하는 것은 기존과 동일합니다. 이부분은 수정되어야       
   합니다. 6개의 섹션 이 아니라 Extract된 문서를 AI가 정리한 섹션 메뉴얼을 생성하는것은 기존과 동일합니다

추가로 AI는 다음을 수행해야 합니다.

모호하거나 누락된 정보, 충돌되는 규정 등을 찾아 “추가 요청사항/수정사항”으로 반환합니다.

사용자에게 이 요청사항을 UI에 표시하여 추가 내용을 입력하도록 지원합니다.

사용자가 수정사항을 채워서 저장하면 manual_sections를 업데이트하고 documents.status는 DRAFT 유지합니다.

Gate 단계 재구성

Gate 버튼을 누르면 다음을 수행합니다.

Manualize에서 저장된 섹션 텍스트를 바탕으로 품질 검증(RED/YELLOW)을 실행합니다.

품질 검증과 동시에 API 스펙 추출을 실행하여 api_specs 테이블에 intent/endpoint/method/필드 등을 채웁니다.

검증 결과와 추출된 API 리스트를 UI에 표시합니다.

이 단계에서는 아직 문서 상태를 APPROVED로 변경하지 않습니다.

Approve 버튼명 변경 및 기능 수정

기존의 “Approve” 버튼을 “RAG 데이터화” 버튼으로 변경합니다.

역할: Gate 단계에서 RED 이슈가 없을 경우에만 활성화하고, 클릭 시 다음을 수행합니다.

documents.status를 APPROVED로 변경.

manual_sections 내용을 청킹하여 chunks 테이블에 저장(재색인).

추출된 API 스펙을 유지한 채 문서를 RAG 지식베이스에 반영합니다.

UI 수정

문서 목록 테이블의 작업 버튼에서 Upgrade·Edit 버튼 삭제.

Manualize 버튼을 클릭하면 팝업/모달에서 자동 정제된 매뉴얼과 추가 요청사항을 보여주고, 사용자가 수정·보완 후 저장할 수 있는 UI를 구현합니다.

Gate 버튼 클릭 시 품질 검증 결과와 함께 API 목록을 보여주는 UI를 구현합니다.

Approve 버튼을 “RAG 데이터화”로 바꿔 위치와 스타일을 유지하고, 위에서 정의한 기능을 수행하도록 연결합니다.

변경해야 할 주요 파일 (예상)

routers/api.py 또는 관련 FastAPI 라우터:

Manualize 엔드포인트 수정: 추가 요청사항 반환 로직 추가.

Gate 엔드포인트 수정: 품질 검증 + API 스펙 추출 동시 수행.

Approve 엔드포인트 삭제 또는 역할 변경 후 rag-dataify 엔드포인트로 교체.

templates/upload.html 및 관련 템플릿:

Upgrade/Edit 버튼 제거.

Manualize 팝업 UI 수정(추가 요청사항 입력 영역 포함).

Approve → RAG 데이터화 버튼명 변경 및 활성화 조건 변경.

Gate 결과 UI에 API 목록 표시 추가.

static/js(사용한다면): Manualize/ Gate/ RAG 데이터화의 모달 동작 및 폼 제출 로직 업데이트.

Acceptance Criteria

업로드된 문서에서 Extract → Manualize 한 번의 흐름으로 매뉴얼 초안과 추가 요청사항을 생성하고, 사용자가 보강한 후 저장할 수 있다.

Gate 버튼 클릭 시 RED/YELLOW 이슈 및 추출된 API 명세가 함께 표시된다.

RAG 데이터화 버튼 클릭 시 RED 이슈가 없을 때만 문서가 APPROVED되고 재색인되며, chunks와 api_specs가 업데이트된다.

Upgrade와 Edit 버튼이 UI에서 완전히 사라진다.