[요청] Manualize 파이프라인을 “기존 방식(A안)”으로 롤백 구현하세요. (프롬프트 오염 금지)

[목표]
- 현재 Split/Chunk/Batch 기반 분할 파이프라인을 기본 경로에서 완전히 비활성화하고,
- 문서 전체(raw_text)를 1회만 MANUALIZE_PROMPT_V3_1에 전달하는 “기존 방식”으로 되돌리세요.
- MANUALIZE_PROMPT_V3_1 내용은 절대 수정하지 마세요. (오염 방지)
- Gate/Fill/Publish는 현재 동작을 그대로 유지합니다.

────────────────────────────────────────
[핵심 동작(기본 경로)]
────────────────────────────────────────
1) 업로드/추출된 raw_text 준비
2) /doc/{doc_id}/manualize 엔드포인트에서 아래를 수행
   - raw_text(문서 전체) 그대로
   - MANUALIZE_PROMPT_V3_1 그대로
   - LLM 호출 “단 1회”
3) 결과(JSON)는 기존 저장 방식(DB/flatten/section_text 저장 등)에 맞춰 저장
4) Gate/Fill/Publish 흐름은 현행 그대로 유지

※ 기본 경로에서는 다음을 “절대” 사용하지 않습니다:
- 헤더/번호/문단 기반 split
- chunk 생성/배치 묶기
- window_size/overlap 반복 호출
- /split → /manualize-batch/{batch_id} × N 호출 플로우
- chunk_id/evidence_span 인덱싱 등 분할 전용 메타데이터

────────────────────────────────────────
[예외 경로(문서가 너무 큰 경우에만)]
────────────────────────────────────────
- 조건: len(raw_text) > HARD_LIMIT 인 경우에만 분할 적용
- HARD_LIMIT 기본값: 15000자
- 분할 방식: heading 기반 split “재사용 금지”, window 방식만 사용

서버 내부 window fallback 규칙:
- window_size: 9000자
- overlap: 600자
- 서버가 raw_text를 window로 내부 분할 → 각 window를 MANUALIZE_PROMPT_V3_1로 순차 호출 → 서버가 결과 JSON들을 “보수적으로 병합” → 최종 1개 JSON으로 합쳐 응답
- 병합 원칙:
  - 새 규칙/수치/절차 생성 금지
  - 완전 동일한 중복만 제거 (애매하면 유지)
- 프론트는 예외 경로에서도 “항상 manualize 1회 호출”만 하게 유지 (split/batch 호출 금지)

────────────────────────────────────────
[Evidence spans / UI 처리]
────────────────────────────────────────
- MANUALIZE_PROMPT_V3_1은 evidence_spans를 생성하지 않으므로 단일 호출 결과에서 evidence_json = NULL 은 정상입니다.
- 프론트는 evidence_json이 없으면 Evidence 패널을 자동 숨김 처리하세요. (에러 표시 금지)

────────────────────────────────────────
[프론트 호출 흐름(최종)]
────────────────────────────────────────
- 롤백 후: /doc/{doc_id}/manualize 1회 호출로 복귀
- 기존: /split → /manualize-batch/{batch_id} × N 는 삭제 또는 feature flag OFF

UI 로딩 표시:
- 단일 호출이므로 섹션 카운터(예: 6/100)는 제거/숨김
- “Manualizing…” + 경과시간 타이머만 표시

────────────────────────────────────────
[유지 범위]
────────────────────────────────────────
- Gate 버튼/검증 흐름(섹션별 PASS/NEED_FIX/BLOCK) 유지
- Fill(맥락 보강) 및 Publish(RAG 반영) 로직 유지
- 분할 기반으로 생겼던 chunk_id/evidence_span 인덱싱 등 메타데이터는 기본 경로에서 사용하지 않거나 무시

────────────────────────────────────────
[검증 체크리스트(필수)]
────────────────────────────────────────
- 문서 1개 업로드 → Manualize LLM 호출이 “정확히 1회만” 발생하는지 서버 로그로 확인
- split/window/batch 반복 호출이 더 이상 발생하지 않는지 확인
- 결과 JSON sections가 원문 헤딩/번호 구조를 그대로 따르는지 확인
- Gate 실행/표시가 정상 동작하는지 확인
- evidence_json 없을 때 Evidence 패널이 자동 숨김되는지 확인
- raw_text > 15000자에서만 window fallback이 동작하는지 확인

[주의]
- 본 작업에서는 성능/발열 이슈를 “분할 기본화”로 해결하지 않습니다. 기본은 품질 우선(1회 처리)이며, 분할은 HARD_LIMIT 초과 예외에서만 허용합니다.
