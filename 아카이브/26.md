목표: 영업/운영 문서를 RAG 반영 전 “Manualize → 최종 Gate 1회 → PASS만 Publish”

원칙: LLM 호출 최소화(불필요한 자동 Gate 재실행 금지)

Pipeline

Extract text (docx/md/pdf text layer 우선, 스캔 페이지는 OCR 선택)

Split: 규칙 기반 분할(LLM 사용 안 함)

Manualize: chunk 단위로 section_text 생성 (+ evidence_spans ≥ 2, PII 마스킹)

Gate: 최종 1회(섹션/문서 단위 정책 택1)

Publish: Gate PASS + evidence span 인덱싱 정상인 것만 RAG 반영

Evidence span 인덱싱 정책

서버가 raw_chunk.find(span_text)로 char_start/end 계산

char_start = -1 은 두 케이스를 구분해야 하므로 evidence_span에 is_pii 필드 추가:

is_pii=true → PII 마스킹으로 find를 의도적으로 스킵한 정상 케이스

is_pii=false → 비PII span 매칭 실패(이상 케이스) → Publish 제외/NEED_FIX 라우팅

UI 정책(비용/혼동 방지)

“적용(저장)”과 “Gate 재검증” 버튼은 분리 권장

자동 “저장+Gate 재검증”은 기본 OFF (사용자가 원할 때만 Gate 실행)

문서목록 Gate = 전체 일괄 Gate, 에디터 Gate = 섹션/문서 재Gate(선택), 비교모달은 저장만 기본